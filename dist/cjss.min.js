var cjss=function(){"use strict";function e(e,t){const r=e.style.getPropertyValue(`--${t}`).trim();if(!r)return null;let n;return(n=r.match(/^([-0-9A-Z_$]*)\s*\(([\s\S]*)\)$/i))?{mode:n[1],body:n[2]}:{body:r}}const t=[];function r(e,r,...n){t[e]||(t[e]={});const o=t[e],c=[].concat(...n);if(c.length)for(const e of c)o[e]=r;else o.fallback=r}function n(e,r){const n=t[r||e.defaultMode];if(!n)throw new Error(`CJSS: Unknown Plugin ${r||`${e.defaultMode} for mode ${r}`}`);const o=n[e]||n.fallback;if(!o)throw new Error(`CJSS: Plugin ${r} does not support stage ${e}.`);return o}function o(e,t,r){return Object.freeze({toString:()=>e,defaultMode:t,fallback:r})}const c={DATA:o("data","json"),PREPARE:o("prepare","js"),BODY:o("body","html","html"),SCRIPT:o("script","js","js"),ordered:[]};c.ordered=Object.freeze([c.DATA,c.PREPARE,c.BODY,c.SCRIPT]),Object.freeze(c);class s extends Error{constructor(e,t){super(e),this.name="CJSSError",this.original=t}}const i=(e,t)=>[].concat(...Array.from(e).map(t));function a(t){const r=function(e){try{return e.rules||e.cssRules||[]}catch(e){if("SecurityError"!==e.name)throw e;return[]}}(t);return i(r,t=>t instanceof CSSImportRule?a(t.styleSheet):t instanceof CSSStyleRule?function(t){const r=t.style.parentRule.selectorText,o=[],i={selector:r,stages:o,processed:new Set},a=(e,t,n)=>(o,c=null)=>{console.error(o.message,o.original),c?console.error(`at selector '${r}' and element`,c):console.error(`at selector '${r}'`),console.error(`in script ${e}: ${t}(${n})`)};for(const i of c.ordered){const c=e(t,i)||i.fallback&&e(t,i.fallback);if(!c)continue;const{mode:l,body:f}=c,u=a(i,l,f);try{o.push({logError:u,selector:r,run:n(i,l)(f),stage:i})}catch(e){if(e instanceof s){u(e);break}throw e}}return o.length?[i]:[]}(t):[])}function l(){!function e(t,r=1/0,n=document){for(const[o,i]of t.entries()){if(o>r)break;const a="script"===i.selector?[null]:n.querySelectorAll(i.selector);for(const r of a){if(i.processed=i.processed||new Set,i.processed.has(r))continue;i.processed.add(r);const n=i.stages.some(e=>e.stage===c.BODY);let a={};for(const e of i.stages)try{a=e.run(r,a)||a}catch(t){if(t instanceof s){e.logError(t,r);break}throw t}n&&e(t,o,r)}}}(i(document.styleSheets,a))}r("json",e=>()=>{try{return JSON.parse(e)}catch(e){if(e instanceof SyntaxError)throw new s(`CJSS: ${e.name} in JSON:`,e);throw e}},c.DATA),r("html",e=>{const t=`return \`${e}\``;try{const e=new Function("data","yield",t);return(t,r)=>{try{t.innerHTML=e.call(t,r,t.innerHTML)}catch(e){throw new s(`CJSS: ${e.name} in HTML evaluation:`,e)}}}catch(e){if(e instanceof SyntaxError)throw new s(`CJSS: ${e.name} in HTML string parsing:`,e);throw e}},c.BODY);const f=(e,t)=>{if("string"==typeof t||t instanceof String)return void(e.innerHTML=t);if(void 0===t)return;for(;e.firstChild;)e.firstChild.remove();const r=t=>{if(null!==t)if((e=>e instanceof Object&&Symbol.iterator in e)(t))for(const e of t)r(e);else t instanceof Node?e.appendChild(t):e.appendChild(document.createTextNode(t))};r(t)},u=(e,t=(e=>e))=>r=>{try{const n=new Function("data",e?"yield":void 0,t(r));return(t,r)=>{try{return e?f(t,n.call(t,r,[...t.childNodes])):n.call(t,r)}catch(e){throw new s(`CJSS: ${e.name} in JS:`,e)}}}catch(e){if(e instanceof SyntaxError)throw new s(`CJSS: ${e.name} in JavaScript parsing:`,e);throw e}};return r("js",u(!1)),r("js",u(!0),c.BODY),r("js-expr",u(!1,e=>`return (${e});`)),r("js-expr",u(!0,e=>`return (${e});`),c.BODY),new Promise(e=>{["complete","interactive","loaded"].includes(document.readyState)?e():document.addEventListener("DOMContentLoaded",e)}).then(()=>document).then(()=>l()),{render:l,registerPlugin:r}}();
