var cjss=function(){"use strict";function e(e,t){const r=e.style.getPropertyValue(`--${t}`).trim();if(!r)return null;let n;return(n=r.match(/^([-0-9A-Z_$]*)\s*\(([\s\S]*)\)$/i))?{mode:n[1],body:n[2]}:{body:r}}const t=[];function r(e,r,...n){t[e]||(t[e]={});const o=t[e],s=[].concat(...n);if(s.length)for(const e of s)o[e]=r;else o.fallback=r}function n(e,r){const n=t[r||e.defaultMode];if(!n)throw new Error(`CJSS: Unknown Plugin ${r||`${e.defaultMode} for mode ${r}`}`);const o=n[e]||n.fallback;if(!o)throw new Error(`CJSS: Plugin ${r} does not support stage ${e}.`);return o}function o(e,t,r){return Object.freeze({toString:()=>e,defaultMode:t,fallback:r})}const s={DATA:o("data","json"),PREPARE:o("prepare","js"),BODY:o("body","html","html"),SCRIPT:o("script","js","js"),ordered:[]};s.ordered=Object.freeze([s.DATA,s.PREPARE,s.BODY,s.SCRIPT]),Object.freeze(s);class c extends Error{constructor(e,t){super(e),this.name="CJSSError",this.original=t}}const a=(e,t)=>[].concat(...Array.from(e).map(t));function i(t){const r=function(e){try{return e.rules||e.cssRules}catch(e){if("SecurityError"!==e.name)throw e;return[]}}(t);return a(r,t=>t instanceof CSSImportRule?i(t.styleSheet):t instanceof CSSStyleRule?function(t){const r=t.style.parentRule.selectorText,o=[],a={selector:r,stages:o,processed:new Set},i=(e,t,n)=>(o,s=null)=>{console.error(o.message,o.original),s?console.error(`at selector '${r}' and element`,s):console.error(`at selector '${r}'`),console.error(`in script ${e}: ${t}(${n})`)};for(const a of s.ordered){const s=e(t,a)||a.fallback&&e(t,a.fallback);if(!s)continue;const{mode:l,body:u}=s,f=i(a,l,u);try{o.push({logError:f,selector:r,run:n(a,l)(u),stage:a})}catch(e){if(e instanceof c){f(e);break}throw e}}return o.length?[a]:[]}(t):[])}function l(){!function e(t,r=1/0,n=document){for(const[o,a]of t.entries()){if(o>r)break;const i="script"===a.selector?[null]:n.querySelectorAll(a.selector);for(const r of i){if(a.processed=a.processed||new Set,a.processed.has(r))continue;a.processed.add(r);const n=a.stages.some(e=>e.stage===s.BODY);let i={};for(const e of a.stages)try{i=e.run(r,i)||i}catch(t){if(t instanceof c){e.logError(t,r);break}throw t}n&&e(t,o,r)}}}(a(document.styleSheets,i))}class u extends Function{run(e=[],t=null){return this.apply(t,e)}}function f(e,t=[]){return new u(...t,e)}r("json",e=>()=>{try{return JSON.parse(e)}catch(e){if(e instanceof SyntaxError)throw new c(`CJSS: ${e.name} in JSON:`,e);throw e}},s.DATA),r("html",e=>{const t=`return \`${e}\``;try{const e=f(t,["data","yield"]);return(t,r)=>{try{t.innerHTML=e.call(t,r,t.innerHTML)}catch(e){throw new c(`CJSS: ${e.name} in HTML evaluation:`,e)}}}catch(e){if(e instanceof SyntaxError)throw new c(`CJSS: ${e.name} in HTML string parsing:`,e);throw e}},s.BODY);const d=(e,t)=>{if("string"==typeof t||t instanceof String)return void(e.innerHTML=t);if(void 0===t)return;for(;e.firstChild;)e.firstChild.remove();const r=t=>{if(null!==t)if((e=>e instanceof Object&&Symbol.iterator in e)(t))for(const e of t)r(e);else t instanceof Node?e.appendChild(t):e.appendChild(document.createTextNode(t))};r(t)},h=(e,t=(e=>e))=>r=>{try{const n=f(t(r),e?["data","yield"]:["data"]);return(t,r)=>{try{return e?d(t,n.call(t,r,[...t.childNodes])):n.call(t,r)}catch(e){throw new c(`CJSS: ${e.name} in JS:`,e)}}}catch(e){if(e instanceof SyntaxError)throw new c(`CJSS: ${e.name} in JavaScript parsing:`,e);throw e}};return r("js",h(!1)),r("js",h(!0),s.BODY),r("js-expr",h(!1,e=>`return (${e});`)),r("js-expr",h(!0,e=>`return (${e});`),s.BODY),new Promise(e=>{["complete","interactive","loaded"].includes(document.readyState)?e():document.addEventListener("DOMContentLoaded",e)}).then(()=>document).then(()=>l()),{render:l,registerPlugin:r}}();
