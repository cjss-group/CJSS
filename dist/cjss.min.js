var CJSS=function(e){"use strict";function t(e,t){const r=e.style.getPropertyValue(`--${t}`).trim();if(!r)return null;let n;return(n=r.match(/^([-0-9A-Z_$]*)\s*\(([\s\S]*)\)$/i))?{mode:n[1],body:n[2]}:{body:r}}const r=[];function n(e,t,...n){r[e]||(r[e]={});const o=r[e],c=[].concat(...n);if(c.length)for(const e of c)o[e]=t;else o.fallback=t}function o(e,t){const n=r[t||e.defaultMode];if(!n)throw new Error(`CJSS: Unknown Plugin ${t||`${e.defaultMode} for mode ${t}`}`);const o=n[e]||n.fallback;if(!o)throw new Error(`CJSS: Plugin ${t} does not support stage ${e}.`);return o}function c(e,t,r){return Object.freeze({toString:()=>e,defaultMode:t,fallback:r})}const s={DATA:c("data","json"),PREPARE:c("prepare","js"),BODY:c("body","html","html"),SCRIPT:c("script","js","js"),ordered:[]};s.ordered=Object.freeze([s.DATA,s.PREPARE,s.BODY,s.SCRIPT]),Object.freeze(s);class i extends Error{constructor(e,t){super(e),this.name="CJSSError",this.original=t}}const a=(e,t)=>[].concat(...Array.from(e).map(t));function l(e){const r=function(e){try{return e.rules||e.cssRules||[]}catch(e){if("SecurityError"!==e.name)throw e;return[]}}(e);return a(r,e=>e instanceof CSSImportRule?l(e.styleSheet):e instanceof CSSStyleRule?function(e){const r=e.style.parentRule.selectorText,n=[],c={selector:r,stages:n,processed:new Set},a=(e,t,n)=>(o,c=null)=>{console.error(o.message,o.original),c?console.error(`at selector '${r}' and element`,c):console.error(`at selector '${r}'`),console.error(`in script ${e}: ${t}(${n})`)};for(const c of s.ordered){const s=t(e,c)||c.fallback&&t(e,c.fallback);if(!s)continue;const{mode:l,body:f}=s,u=a(c,l,f);try{n.push({logError:u,selector:r,run:o(c,l)(f),stage:c})}catch(e){if(e instanceof i){u(e);break}throw e}}return n.length?[c]:[]}(e):[])}function f(){!function e(t,r=1/0,n=document){for(const[o,c]of t.entries()){if(o>r)break;const a="script"===c.selector?[null]:n.querySelectorAll(c.selector);for(const r of a){if(c.processed=c.processed||new Set,c.processed.has(r))continue;c.processed.add(r);const n=c.stages.some(e=>e.stage===s.BODY);let a={};for(const e of c.stages)try{const t=e.run(r,a);void 0!==t&&(a=t)}catch(t){if(t instanceof i){e.logError(t,r);break}throw t}n&&e(t,o,r)}}}(a(document.styleSheets,l))}function u(e,t){if("string"==typeof t||t instanceof String)return void(e.innerHTML=t);if(void 0===t)return;for(;e.firstChild;)e.firstChild.remove();const r=t=>{if(null!==t)if((e=>e instanceof Object&&Symbol.iterator in e)(t))for(const e of t)r(e);else t instanceof Node?e.appendChild(t):e.appendChild(document.createTextNode(t))};r(t)}var d=Object.freeze({assignBody:u});n("json",e=>()=>{try{return JSON.parse(e)}catch(e){if(e instanceof SyntaxError)throw new i(`CJSS: ${e.name} in JSON:`,e);throw e}},s.DATA);const S=(e,t=(e=>e))=>r=>{try{const n=new Function("data",e?"yield":void 0,t(r));return(t,r)=>{try{return e?u(t,n.call(t,r,[...t.childNodes])):n.call(t,r)}catch(e){throw new i(`CJSS: ${e.name} in JS:`,e)}}}catch(e){if(e instanceof SyntaxError)throw new i(`CJSS: ${e.name} in JavaScript parsing:`,e);throw e}};return n("js",S(!1)),n("js",S(!0),s.BODY),n("js-expr",S(!1,e=>`return (${e});`)),n("js-expr",S(!0,e=>`return (${e});`),s.BODY),n("html",e=>{const t=`return \`${e}\``;try{const e=new Function("data","yield",t);return(t,r)=>{try{t.innerHTML=e.call(t,r,t.innerHTML)}catch(e){throw new i(`CJSS: ${e.name} in HTML evaluation:`,e)}}}catch(e){if(e instanceof SyntaxError)throw new i(`CJSS: ${e.name} in HTML string parsing:`,e);throw e}},s.BODY),new Promise(e=>{["complete","interactive","loaded"].includes(document.readyState)?e():document.addEventListener("DOMContentLoaded",e)}).then(()=>document).then(()=>f()),e.Error=i,e.PluginHelpers=d,e.Stage=s,e.registerPlugin=n,e.render=f,e}({});
